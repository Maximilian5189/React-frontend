{"ast":null,"code":"import _slicedToArray from \"/Users/maximilian/privat/React-frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/Users/maximilian/privat/React-frontend/src/components/Shop.js\";\nimport React, { useState, useContext, useEffect } from 'react';\nimport { IonCard, IonPage, IonText, IonItemDivider, IonButton, IonItem, IonList, IonLabel, IonNote, IonChip, IonBadge, IonContent, IonCardContent } from '@ionic/react';\nimport { UserContext } from '../GlobalState';\n\nconst Shop = props => {\n  const userContext = useContext(UserContext);\n\n  const _useState = useState([]),\n        _useState2 = _slicedToArray(_useState, 2),\n        shopItems = _useState2[0],\n        setShopItems = _useState2[1];\n\n  const _useState3 = useState([]),\n        _useState4 = _slicedToArray(_useState3, 2),\n        cart = _useState4[0],\n        setCart = _useState4[1];\n\n  const _useState5 = useState(),\n        _useState6 = _slicedToArray(_useState5, 2),\n        shopMessage = _useState6[0],\n        setShopMessage = _useState6[1];\n\n  const _useState7 = useState(),\n        _useState8 = _slicedToArray(_useState7, 2),\n        cartMessage = _useState8[0],\n        setCartMessage = _useState8[1];\n\n  const _useState9 = useState('offers'),\n        _useState10 = _slicedToArray(_useState9, 2),\n        shopContentToDisplay = _useState10[0],\n        setShopContentToDisplay = _useState10[1];\n\n  const addItemToCart = item => {\n    let itemAlreadyInCart = false;\n    cart.forEach(cartItem => {\n      if (cartItem.identifier === item.identifier) {\n        itemAlreadyInCart = true;\n      }\n    });\n\n    if (itemAlreadyInCart) {\n      setCartMessage(React.createElement(IonNote, {\n        color: \"danger\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 21\n        },\n        __self: this\n      }, \"Item schon in Wagen\"));\n    } else {\n      setCartMessage(React.createElement(IonNote, {\n        color: \"success\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 23\n        },\n        __self: this\n      }, \"Item \", item.identifier, \" erfolgreich zum Wagen hinzugef\\xFCgt\"));\n      setCart([...cart, item]);\n    }\n  };\n\n  const removeItemFromCart = item => {\n    const newCartState = [];\n    cart.forEach(cartItem => {\n      if (cartItem.identifier !== item.identifier) {\n        newCartState.push(cartItem);\n      }\n    });\n    setCart(newCartState);\n  };\n\n  const buyItems = () => {\n    if (!userContext.userState.login) {\n      setShopMessage(React.createElement(IonText, {\n        color: \"danger\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 40\n        },\n        __self: this\n      }, React.createElement(\"p\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 40\n        },\n        __self: this\n      }, \"Bitte einloggen!\")));\n      return;\n    } else if (cart.length === 0) {\n      setShopMessage(React.createElement(IonText, {\n        color: \"danger\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 43\n        },\n        __self: this\n      }, React.createElement(\"p\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 43\n        },\n        __self: this\n      }, \"Nix im Korb!\")));\n      return;\n    }\n\n    const token = localStorage.token;\n    let body = {\n      data: cart\n    };\n    body = JSON.stringify(body);\n    const url = 'http://3.123.35.137/user';\n    fetch(url, {\n      headers: {\n        'Content-Type': 'application/json',\n        Authorization: 'bearer ' + token\n      },\n      body: body,\n      method: 'PATCH'\n    }).then(response => {\n      return response.json();\n    }).then(backendAnswer => {\n      if (backendAnswer.success === true) {\n        setShopMessage(React.createElement(IonText, {\n          color: \"success\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 62\n          },\n          __self: this\n        }, React.createElement(\"p\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 62\n          },\n          __self: this\n        }, \"Kauf erfolgreich!\")));\n        setCart([]);\n        setCartMessage('');\n      } else if (backendAnswer.duplicate === true) {\n        setShopMessage(React.createElement(IonText, {\n          color: \"danger\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 66\n          },\n          __self: this\n        }, React.createElement(\"p\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 66\n          },\n          __self: this\n        }, \"Kauf nicht erfolgreich. Ware besitzen Sie schon.\")));\n      } else {\n        setShopMessage(React.createElement(IonText, {\n          color: \"danger\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 68\n          },\n          __self: this\n        }, React.createElement(\"p\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 68\n          },\n          __self: this\n        }, \"Kauf nicht erfolgreich.\")));\n      }\n    }).catch(error => {\n      console.log(error);\n    });\n  };\n\n  useEffect(() => {\n    setShopMessage('');\n    setCartMessage('');\n  }, [userContext.userState.login, props.tabChanged]);\n  useEffect(() => {\n    fetch('http://3.123.35.137/data', {\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      method: 'GET'\n    }).then(response => {\n      return response.json();\n    }).then(backendAnswer => {\n      if (backendAnswer.success === true) {\n        console.log(backendAnswer);\n        setShopItems(backendAnswer.data);\n      }\n    }).catch(error => {\n      console.log(error);\n    });\n  }, []);\n\n  if (shopContentToDisplay === 'offers') {\n    return React.createElement(IonPage, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 105\n      },\n      __self: this\n    }, React.createElement(IonContent, {\n      className: \"ion-padding\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 106\n      },\n      __self: this\n    }, React.createElement(IonChip, {\n      onClick: () => setShopContentToDisplay('offers'),\n      class: \"ion-margin\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 107\n      },\n      __self: this\n    }, \"Angebot\"), React.createElement(IonChip, {\n      onClick: () => setShopContentToDisplay('cart'),\n      class: \"ion-margin\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 108\n      },\n      __self: this\n    }, \"Einkaufswagen\", React.createElement(IonBadge, {\n      class: \"ion-margin-start\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 110\n      },\n      __self: this\n    }, cart.length)), React.createElement(IonItemDivider, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 112\n      },\n      __self: this\n    }, \"Angebot:\"), React.createElement(IonList, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 113\n      },\n      __self: this\n    }, shopItems.map((item, index) => {\n      return React.createElement(IonItem, {\n        key: index,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 116\n        },\n        __self: this\n      }, React.createElement(IonLabel, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 117\n        },\n        __self: this\n      }, item.identifier), React.createElement(IonButton, {\n        slot: \"end\",\n        onClick: () => addItemToCart(item),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 118\n        },\n        __self: this\n      }, \"In den Einkaufswagen\"));\n    })), cartMessage));\n  } else {\n    return React.createElement(IonPage, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 129\n      },\n      __self: this\n    }, React.createElement(IonContent, {\n      className: \"ion-padding\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 130\n      },\n      __self: this\n    }, React.createElement(IonChip, {\n      onClick: () => setShopContentToDisplay('offers'),\n      class: \"ion-margin\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 131\n      },\n      __self: this\n    }, \"Angebot\"), React.createElement(IonChip, {\n      onClick: () => setShopContentToDisplay('cart'),\n      class: \"ion-margin\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 132\n      },\n      __self: this\n    }, \"Einkaufswagen\", React.createElement(IonBadge, {\n      class: \"ion-margin-start\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 134\n      },\n      __self: this\n    }, cart.length)), React.createElement(IonCard, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 136\n      },\n      __self: this\n    }, React.createElement(IonCardContent, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 137\n      },\n      __self: this\n    }, React.createElement(IonItemDivider, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 138\n      },\n      __self: this\n    }, \"Einkaufswagen:\"), React.createElement(IonList, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 139\n      },\n      __self: this\n    }, cart.map((item, index) => {\n      return React.createElement(IonItem, {\n        key: index,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 142\n        },\n        __self: this\n      }, React.createElement(IonLabel, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 143\n        },\n        __self: this\n      }, item.identifier), React.createElement(IonButton, {\n        slot: \"end\",\n        onClick: () => removeItemFromCart(item),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 144\n        },\n        __self: this\n      }, \"Entfernen\"));\n    })), React.createElement(IonButton, {\n      class: \"ion-margin-bottom\",\n      onClick: () => buyItems(),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 149\n      },\n      __self: this\n    }, \"Den Bums kaufen\"), shopMessage))));\n  }\n};\n\nexport default Shop;","map":{"version":3,"sources":["/Users/maximilian/privat/React-frontend/src/components/Shop.js"],"names":["React","useState","useContext","useEffect","IonCard","IonPage","IonText","IonItemDivider","IonButton","IonItem","IonList","IonLabel","IonNote","IonChip","IonBadge","IonContent","IonCardContent","UserContext","Shop","props","userContext","shopItems","setShopItems","cart","setCart","shopMessage","setShopMessage","cartMessage","setCartMessage","shopContentToDisplay","setShopContentToDisplay","addItemToCart","item","itemAlreadyInCart","forEach","cartItem","identifier","removeItemFromCart","newCartState","push","buyItems","userState","login","length","token","localStorage","body","data","JSON","stringify","url","fetch","headers","Authorization","method","then","response","json","backendAnswer","success","duplicate","catch","error","console","log","tabChanged","map","index"],"mappings":"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","sourcesContent":["import React, { useState, useContext, useEffect } from 'react';\nimport { IonCard, IonPage, IonText, IonItemDivider, IonButton, IonItem, IonList, IonLabel, IonNote, IonChip, IonBadge, IonContent, IonCardContent } from '@ionic/react';\nimport { UserContext } from '../GlobalState';\n\nconst Shop = props => {\n  const userContext = useContext(UserContext);\n  const [shopItems, setShopItems] = useState([]);\n  const [cart, setCart] = useState([])\n  const [shopMessage, setShopMessage] = useState();\n  const [cartMessage, setCartMessage] = useState();\n  const [shopContentToDisplay, setShopContentToDisplay] = useState('offers');\n\n  const addItemToCart = (item) => {\n    let itemAlreadyInCart = false;\n    cart.forEach(cartItem => {\n      if (cartItem.identifier === item.identifier) {\n        itemAlreadyInCart = true;\n      }\n    })\n    if (itemAlreadyInCart) {\n      setCartMessage(<IonNote color=\"danger\">Item schon in Wagen</IonNote>)\n    } else {\n    setCartMessage(<IonNote color=\"success\">Item {item.identifier} erfolgreich zum Wagen hinzugefügt</IonNote>)\n      setCart([...cart, item])\n    }\n  }\n\n  const removeItemFromCart = (item) => {\n    const newCartState = [];\n    cart.forEach(cartItem => {\n      if (cartItem.identifier !== item.identifier) {\n        newCartState.push(cartItem)\n      }\n    })\n    setCart(newCartState)\n  }\n\n  const buyItems = () => {\n    if (!userContext.userState.login) {\n      setShopMessage(<IonText color=\"danger\"><p>Bitte einloggen!</p></IonText>)\n      return\n    } else if (cart.length === 0) {\n      setShopMessage(<IonText color=\"danger\"><p>Nix im Korb!</p></IonText>)\n      return\n    }\n\n    const token = localStorage.token\n    let body = { data: cart };\n    body = JSON.stringify(body);\n    const url = 'http://3.123.35.137/user';\n    fetch(url, {\n      headers: {'Content-Type': 'application/json',\n      Authorization: 'bearer ' + token},\n      body: body,\n      method: 'PATCH'\n    })\n    .then(response => {\n      return response.json();\n    })\n    .then(backendAnswer => {\n      if (backendAnswer.success === true) {\n        setShopMessage(<IonText color=\"success\"><p>Kauf erfolgreich!</p></IonText>)\n        setCart([])\n        setCartMessage('')\n      } else if (backendAnswer.duplicate === true) {\n        setShopMessage(<IonText color=\"danger\"><p>Kauf nicht erfolgreich. Ware besitzen Sie schon.</p></IonText>)\n      } else {\n        setShopMessage(<IonText color=\"danger\"><p>Kauf nicht erfolgreich.</p></IonText>)\n      }\n    })\n    .catch(error => {\n      console.log(error)\n    })\n  }\n\n  useEffect(() => {\n    setShopMessage('')\n    setCartMessage('')\n  }, [userContext.userState.login, props.tabChanged])\n\n  useEffect(() => {\n    fetch('http://3.123.35.137/data', \n    {\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      method: 'GET'\n    })\n    .then(response => {\n      return response.json();\n    })\n    .then(backendAnswer => {\n      if (backendAnswer.success === true) {\n        console.log(backendAnswer)\n        setShopItems(backendAnswer.data)\n      }\n    })\n    .catch(error => {\n      console.log(error)\n    })\n  }, [])\n\n  if (shopContentToDisplay ==='offers') {\n    return (\n      <IonPage>\n        <IonContent className=\"ion-padding\">\n          <IonChip onClick={() => setShopContentToDisplay('offers')} class=\"ion-margin\">Angebot</IonChip>\n          <IonChip onClick={() => setShopContentToDisplay('cart')} class=\"ion-margin\">\n            Einkaufswagen\n            <IonBadge class=\"ion-margin-start\">{cart.length}</IonBadge>\n          </IonChip>\n          <IonItemDivider>Angebot:</IonItemDivider>\n          <IonList>\n            {shopItems.map((item, index) => {\n              return (\n                <IonItem key={index}>\n                  <IonLabel>{item.identifier}</IonLabel>\n                  <IonButton slot=\"end\" onClick={() => addItemToCart(item)}>In den Einkaufswagen</IonButton>\n                </IonItem>\n              )\n            })}\n          </IonList>\n          {cartMessage}\n        </IonContent>\n      </IonPage>\n    )\n  } else {\n    return (\n      <IonPage>\n        <IonContent className=\"ion-padding\">\n          <IonChip onClick={() => setShopContentToDisplay('offers')} class=\"ion-margin\">Angebot</IonChip>\n          <IonChip onClick={() => setShopContentToDisplay('cart')} class=\"ion-margin\">\n            Einkaufswagen\n            <IonBadge class=\"ion-margin-start\">{cart.length}</IonBadge>\n            </IonChip>\n            <IonCard>\n              <IonCardContent>\n              <IonItemDivider>Einkaufswagen:</IonItemDivider>\n              <IonList>\n                {cart.map((item, index) => {\n                  return (\n                    <IonItem key={index}>\n                      <IonLabel>{item.identifier}</IonLabel>\n                      <IonButton slot=\"end\" onClick={() => removeItemFromCart(item)}>Entfernen</IonButton>\n                    </IonItem>\n                  )\n                })}\n              </IonList>\n              <IonButton class=\"ion-margin-bottom\" onClick={() => buyItems()}>Den Bums kaufen</IonButton>\n              {shopMessage}\n              </IonCardContent>\n            </IonCard>\n        </IonContent>\n      </IonPage>\n    )\n  }\n  \n}\n\nexport default Shop"]},"metadata":{},"sourceType":"module"}